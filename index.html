<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard V1 - Original</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Nunito:wght@800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F7F8F9;
        }

        .card-hover {
            transition: all 0.3s ease-out;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #cbd5e1;
        }

        .category-header {
            font-family: 'Nunito', sans-serif;
            font-weight: 800;
            font-size: 18px;
            font-style: italic;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #1B3DA1;
            margin-bottom: 1.5rem;
            margin-top: 2rem;
            cursor: pointer;
            user-select: none;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: background-color 0.2s;
        }

        .category-header:hover {
            background-color: rgba(241, 245, 249, 0.8);
        }

        .category-header .chevron-icon {
            font-size: 14px;
            color: #94a3b8;
            transition: transform 0.3s ease;
        }

        .category-header.collapsed .chevron-icon {
            transform: rotate(-90deg);
        }

        .module-grid {
            transition: all 0.3s ease;
            padding-top: 0.5rem;
            /* Space for hover translation */
            margin-top: -0.5rem;
            /* Offset padding */
        }

        .module-grid.collapsed {
            display: none;
        }

        /* --- App Store Mode Redesign --- */
        .app-store-view .module-grid,
        .app-store-view.view-container#flat-view {
            grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {

            .app-store-view .module-grid,
            .app-store-view.view-container#flat-view {
                grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
            }
        }

        @media (min-width: 1280px) {

            .app-store-view .module-grid,
            .app-store-view.view-container#flat-view {
                grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
            }
        }

        /* Cards in App Store View */
        .app-store-view .card-hover {
            height: 100px !important;
            padding-left: 1.25rem;
            padding-right: 1.25rem;
        }

        .app-store-view .card-hover h3 {
            font-size: 15px;
        }

        .view-details {
            display: none;
            font-size: 12px;
            color: #2563eb;
            font-weight: 500;
            margin-top: 2px;
            transition: all 0.2s;
        }

        .view-details:hover {
            text-decoration: underline;
        }

        .app-store-view .view-details {
            display: block;
        }

        /* Status Buttons (Soft Colors) */
        .status-badge {
            display: none;
            padding: 0.35rem 0.75rem;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            border-width: 1px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .app-store-view .status-badge {
            display: inline-flex;
        }

        /* Hide star in App Store mode */
        .app-store-view .favorite-star {
            display: none !important;
        }

        /* Green - Activated */
        .status-active {
            background-color: #f0fdf4;
            color: #16a34a;
            border-color: #dcfce7;
        }

        .status-active:hover {
            background-color: #dcfce7;
        }

        /* Amber - Pending */
        .status-pending {
            background-color: #fffbeb;
            color: #d97706;
            border-color: #fef3c7;
        }

        .status-pending:hover {
            background-color: #fef3c7;
        }

        /* Blue - Activate */
        .status-inactive {
            background-color: #eff6ff;
            color: #2563eb;
            border-color: #dbeafe;
        }

        .status-inactive:hover {
            background-color: #dbeafe;
        }

        /* --- Module Themes --- */
        .card-light-bg {
            background-color: rgba(var(--theme-rgb, 51, 65, 85), 0.08) !important;
            border-color: rgba(var(--theme-rgb, 51, 65, 85), 0.15) !important;
        }

        .card-light-bg:hover {
            background-color: rgba(var(--theme-rgb, 51, 65, 85), 0.12) !important;
            border-color: rgba(var(--theme-rgb, 51, 65, 85), 0.3) !important;
        }

        /* Segmented Control Styling (Old - will be replaced by Gallery) */
        .style-gallery {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .style-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            gap: 4px;
        }

        .style-item:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .style-item.active {
            border-color: #2563eb;
            background: #eff6ff;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        .style-preview {
            width: 100%;
            height: 24px;
            border-radius: 4px;
            background: white;
            border: 1px solid #cbd5e1;
            position: relative;
            overflow: hidden;
        }

        .style-name {
            font-size: 10px;
            font-weight: 600;
            color: #475569;
        }

        .style-item.active .style-name {
            color: #2563eb;
        }

        /* --- Theme Implementation Classes --- */

        /* Specific Preview Decorations */
        .preview-light-bg {
            background-color: rgba(59, 130, 246, 0.1);
        }



        /* Smooth View Transitions */
        .view-container {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 1;
        }

        .view-container.fade-out {
            opacity: 0;
            transform: translateY(10px) scale(0.98);
            pointer-events: none;
        }

        /* --- App Description Modal --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 1.5rem;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            padding: 2rem 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid #f1f5f9;
        }

        .modal-body {
            padding: 1.5rem 2rem 2rem;
        }

        .modal-footer {
            padding: 0 2rem 2rem;
            display: flex;
            justify-content: center;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            color: #94a3b8;
            cursor: pointer;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: #64748b;
        }

        /* Classic Theme */
        .card-classic {
            background: #fff !important;
            border: 1px solid #f1f5f9 !important;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05) !important;
        }

        .card-classic:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
        }

        .card-classic .w-14 {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            width: auto !important;
            height: auto !important;
            padding-right: 12px !important;
        }

        .card-classic .w-14 i {
            font-size: 2rem !important;
            /* Larger icon */
        }

        /* High specificity Vertical Icon Theme (8 columns) */
        html body.theme-vertical-8 .module-grid,
        html body.theme-vertical-8 #favorites-grid,
        html body.theme-vertical-8 #flat-view.view-container {
            grid-template-columns: repeat(8, minmax(0, 1fr)) !important;
            grid-template-rows: auto !important;
            gap: 1.5rem 0.5rem !important;
            /* More row gap, less col gap */
            display: grid !important;
        }

        body.theme-vertical-8 .card-vertical-8 {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            padding: 0 !important;
            height: auto !important;
            width: 100% !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: flex-start !important;
            gap: 0.5rem !important;
            transition: none !important;
            overflow: visible !important;
            transform: none !important;
            margin: 0 auto !important;
            /* Neutralize card-hover */
        }

        body.theme-vertical-8 .card-vertical-8:hover {
            transform: none !important;
            box-shadow: none !important;
            border-color: transparent !important;
        }

        body.theme-vertical-8 .card-vertical-8 .w-14 {
            margin-right: 0 !important;
            background: white !important;
            border: 1px solid #f1f5f9 !important;
            border-radius: 1.25rem !important;
            /* 20px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05) !important;
            width: 64px !important;
            height: 64px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.2s ease !important;
            flex-shrink: 0 !important;
        }

        body.theme-vertical-8 .card-vertical-8:hover .w-14 {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important;
            border-color: #e2e8f0 !important;
        }

        body.theme-vertical-8 .card-vertical-8 h3 {
            white-space: normal !important;
            font-size: 13px !important;
            font-weight: 600 !important;
            color: #1e293b !important;
            text-align: center !important;
            margin-top: 4px !important;
            line-height: 1.2 !important;
            max-width: 100% !important;
            word-wrap: break-word !important;
        }

        /* Wave Theme (3 columns) */
        html body.theme-wave .module-grid,
        html body.theme-wave #favorites-grid,
        html body.theme-wave #flat-view.view-container {
            grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
            grid-template-rows: auto !important;
            gap: 1.25rem !important;
            display: grid !important;
        }

        body.theme-wave .card-wave {
            background: linear-gradient(135deg,
                    rgba(var(--theme-rgb, 59, 130, 246), 0.03) 0%,
                    white 100%) !important;
            border: 1px solid #f1f5f9 !important;
            border-radius: 1.5rem !important;
            padding: 1.25rem !important;
            height: 100px !important;
            width: 100% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: flex-start !important;
            gap: 1.25rem !important;
            position: relative !important;
            overflow: hidden !important;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05) !important;
            transition: all 0.3s ease !important;
            transform: none !important;
        }

        body.theme-wave .card-wave:hover {
            transform: translateY(-4px) !important;
        }

        /* Ensure icon color doesn't change on hover for Wave theme */
        body.theme-wave .card-wave:hover .w-14 i {
            color: inherit !important;
        }

        /* Wave Pattern using local image */
        body.theme-wave .card-wave::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 260px;
            height: 100%;
            background-image: url("wave.png");
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center right;
            pointer-events: none;
            opacity: 0.3;
            z-index: 1;
            mask-image: linear-gradient(to right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 40%);
            -webkit-mask-image: linear-gradient(to right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 40%);
        }

        body.theme-wave .card-wave .w-14 {
            background: white !important;
            border-radius: 1.1rem !important;
            width: 58px !important;
            height: 58px !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05) !important;
            margin-right: 0 !important;
        }

        body.theme-wave .card-wave h3 {
            font-size: 16px !important;
            font-weight: 700 !important;
        }

        body.theme-wave .card-wave .flex-1 {
            z-index: 2;
        }

        /* Access link in wave theme */
        .wave-access {
            display: none;
            font-size: 11px;
            color: #3b82f6;
            /* Will be updated via JS to match icon color if possible, or stay blue */
            font-weight: 600;
            margin-top: 2px;
            opacity: 0.8;
        }

        body.theme-wave .wave-access {
            display: block !important;
        }

        /* Hide stars when category view is disabled */
        body.hide-stars .favorite-star {
            display: none !important;
        }

        .app-store-view .module-grid {
            grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
        }

        /* Snow Canvas Styling */
        #snow-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        /* Dark Theme Text Overrides - Refined to protect cards */
        body.theme-dark .category-header,
        body.theme-dark main>div>h1,
        body.theme-dark main>div>p {
            color: white !important;
        }

        /* Target general text that is NOT inside a module card */
        body.theme-dark .text-slate-400:not(.card-hover *),
        body.theme-dark .text-slate-500:not(.card-hover *),
        body.theme-dark .text-slate-600:not(.card-hover *) {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        body.theme-dark .text-slate-800:not(.card-hover *) {
            color: white !important;
        }

        /* Ensure dropdowns remain readable */
        body.theme-dark #displayDropdown,
        body.theme-dark #bizDropdown {
            background-color: white !important;
            color: #1e293b !important;
        }

        body.theme-dark #displayDropdown *,
        body.theme-dark #bizDropdown * {
            color: inherit !important;
        }

        body.theme-dark #displayDropdown .text-slate-400,
        body.theme-dark #displayDropdown .text-slate-700 {
            color: inherit !important;
        }

        /* --- Dark Mode Refinements --- */

        /* 1. Toolbar Refinement */
        body.theme-dark #toolbar-section {
            background-color: #1f2937 !important;
            /* Gray 800 */
            border-color: #374151 !important;
            /* Gray 700 */
        }

        body.theme-dark #search-box {
            background-color: rgba(0, 0, 0, 0.3) !important;
            border-color: #4b5563 !important;
            color: white !important;
        }

        body.theme-dark #search-box::placeholder {
            color: #9ca3af !important;
        }

        /* Fix buttons with bg-white class in dark mode */
        body.theme-dark #toolbar-section button.bg-white {
            background-color: #374151 !important;
            border-color: #4b5563 !important;
            color: #e5e7eb !important;
        }

        body.theme-dark #toolbar-section button.bg-white:hover {
            background-color: #4b5563 !important;
            color: white !important;
        }

        /* Active buttons refine */
        body.theme-dark #toolbar-section .bg-blue-600 {
            background-color: #2563eb !important;
            border-color: #3b82f6 !important;
        }

        /* 2. Status Filter Refinement */
        body.theme-dark #status-filter-container span {
            color: #9ca3af !important;
            /* Gray 400 */
        }

        body.theme-dark #status-filter {
            background-color: #1f2937 !important;
            border-color: #374151 !important;
            color: #f3f4f6 !important;
        }

        /* 3. Module Card Refinement in Dark Mode */
        body.theme-dark .card-hover {
            background-color: #1f2937 !important;
            /* Gray 800 */
            border-color: #374151 !important;
            /* Gray 700 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2) !important;
        }

        body.theme-dark .card-hover:hover {
            border-color: #4b5563 !important;
        }

        /* --- Custom Wallpaper Glassmorphism --- */
        body.theme-wallpaper #toolbar-section {
            background-color: transparent !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            border-color: transparent !important;
            box-shadow: none !important;
        }

        body.theme-wallpaper .card-hover {
            background-color: rgba(255, 255, 255, 0.08) !important;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-color: rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3) !important;
        }

        body.theme-wallpaper .card-hover:hover {
            background-color: rgba(255, 255, 255, 0.15) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        body.theme-wallpaper #welcome-section h1,
        body.theme-wallpaper #welcome-section p {
            color: white !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* --- Wallpaper Selection Highlights --- */
        .bg-btn-active {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        #custom-bg-thumb {
            width: 24px;
            height: 24px;
            border-radius: 9999px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-size: cover;
            background-position: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #custom-bg-thumb:hover {
            transform: scale(1.1);
        }

        body.theme-dark .card-hover h3 {
            color: #f9fafb !important;
        }

        body.theme-dark .card-hover .view-details,
        body.theme-dark .card-hover .wave-access {
            color: #60a5fa !important;
            /* Lighter blue for dark mode */
        }

        /* 4. Footer in Dark Mode */
        body.theme-dark footer p {
            color: #6b7280 !important;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col text-slate-800 relative">

    <!-- Header (Deep Blue) -->
    <header id="main-header" style="background: linear-gradient(135deg, #1B3DA1 0%, #0F256E 100%);"
        class=" h-16 text-white px-6 flex items-center justify-between shadow-lg z-50 fixed w-full top-0 transition-opacity duration-300">
        <!-- Left Section -->
        <div class="flex items-center gap-8">
            <!-- Logo -->
            <div class="flex items-center">
                <div class="h-[38px] flex items-center justify-center">
                    <img src="logo2.png" alt="App.vn Logo" class="h-6 object-contain">
                </div>
            </div>


            <!-- BIZ Dropdown -->
            <div class="relative">
                <button
                    onclick="document.getElementById('bizDropdown').classList.toggle('hidden'); event.stopPropagation();"
                    class="flex items-center gap-2 text-white/90 hover:text-white font-medium transition-all cursor-pointer h-9 ml-2">
                    <img src="l55702188101656-1666339957875559117998.jpg"
                        class="w-6 h-6 rounded-full object-cover opacity-90" alt="Biz Avatar">
                    <span class="text-sm font-semibold tracking-wide">Trang Test</span>
                    <i class="fa-solid fa-chevron-down text-[10px] opacity-70 ml-1"></i>
                </button>
                <!-- Dropdown Menu -->
                <div id="bizDropdown"
                    class="absolute top-full left-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-slate-200 overflow-hidden hidden z-50 animate-in fade-in slide-in-from-top-2 duration-200"
                    onclick="event.stopPropagation()">
                    <div class="p-1">
                        <div class="px-3 py-2 text-[10px] font-bold text-slate-400 uppercase tracking-wider">Ch·ªçn doanh
                            nghi·ªáp</div>
                        <a href="#"
                            class="flex items-center justify-between px-3 py-2 rounded-md hover:bg-slate-50 group transition-colors">
                            <div class="flex items-center gap-2">
                                <img src="l55702188101656-1666339957875559117998.jpg"
                                    class="w-5 h-5 rounded-full object-cover" alt="Trang Test">
                                <span class="text-sm font-medium text-slate-700">Trang Test</span>
                            </div>
                            <i class="fa-solid fa-check text-blue-500 text-xs"></i>
                        </a>
                        <a href="#"
                            class="flex items-center px-3 py-2 rounded-md hover:bg-slate-50 group transition-colors">
                            <span class="text-sm font-medium text-slate-700">Biz 1</span>
                        </a>
                        <a href="#"
                            class="flex items-center px-3 py-2 rounded-md hover:bg-slate-50 group transition-colors">
                            <span class="text-sm font-medium text-slate-700">Biz 2</span>
                        </a>
                    </div>
                </div>
            </div>

            <script>
                document.addEventListener('click', function (event) {
                    var bizDropdown = document.getElementById('bizDropdown');
                    if (bizDropdown && !bizDropdown.contains(event.target)) {
                        bizDropdown.classList.add('hidden');
                    }
                });
            </script>
        </div>


        <!-- Right Side -->
        <div class="flex items-center gap-4">
            <!-- Support -->
            <button class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-white/10 transition-colors"
                title="Li√™n h·ªá">
                <i class="fa-solid fa-headset text-xl opacity-90"></i>
            </button>
            <!-- Documentation -->
            <button class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-white/10 transition-colors"
                title="T√†i li·ªáu">
                <i class="fa-regular fa-file-lines text-xl opacity-90"></i>
            </button>
            <!-- Notifications -->
            <button
                class="relative w-10 h-10 rounded-full flex items-center justify-center hover:bg-white/10 transition-colors">
                <i class="fa-regular fa-bell text-xl opacity-90"></i>
                <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border border-[#172B85]"></span>
            </button>
            <div class="flex items-center gap-3 pl-4 border-l border-white/20">
                <div class="text-right hidden sm:block leading-tight">
                    <div class="text-sm font-semibold">Harley</div>
                    <div class="text-[11px] text-blue-200 opacity-80">Owner</div>
                </div>
                <div
                    class="w-9 h-9 rounded-full bg-blue-400 border border-white/20 flex items-center justify-center shadow-md text-white font-bold text-xs">
                    HA
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 pt-24 pb-12 px-6 max-w-7xl mx-auto w-full">

        <!-- Welcome Section -->
        <div id="welcome-section" class="mb-8 transition-opacity duration-300">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">Xin ch√†o, Harley! üëã</h1>
            <p class="text-slate-500 text-lg">Ch√†o m·ª´ng b·∫°n quay tr·ªü l·∫°i. H√£y ch·ªçn m·ªôt module ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m vi·ªác.</p>
        </div>



        <!-- Toolbar -->
        <div id="toolbar-section"
            class="bg-white rounded-lg shadow-sm border border-slate-200 p-4 mb-6 transition-opacity duration-300">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                <!-- Left Side - Search -->
                <div class="relative flex-1 max-w-2xl">
                    <input type="text" id="search-box" placeholder="T√¨m ki·∫øm ·ª©ng d·ª•ng"
                        class="w-full px-4 py-2 pl-10 bg-white border border-slate-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                        oninput="searchModules(this.value)">
                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                </div>

                <!-- Right Side - Actions -->
                <div class="flex items-center gap-2 w-full md:w-auto flex-wrap">
                    <!-- Tab Navigation -->
                    <button id="btn-my-apps"
                        class="flex items-center gap-1.5 px-4 py-2 bg-blue-600 border border-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-all shadow-md whitespace-nowrap">
                        <i class="fa-solid fa-house text-xs"></i>
                        ·ª®ng d·ª•ng c·ªßa t√¥i
                    </button>
                    <button id="btn-app-store"
                        class="flex items-center gap-1.5 px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-md text-sm font-medium hover:bg-slate-50 hover:text-blue-600 transition-all whitespace-nowrap">
                        <i class="fa-solid fa-table-cells text-xs"></i>
                        Kho ·ª©ng d·ª•ng
                    </button>


                    <button
                        class="flex items-center gap-1.5 px-3 py-2 bg-white border border-slate-200 text-slate-600 rounded-md text-sm font-medium hover:bg-slate-50 hover:text-blue-600 transition-all whitespace-nowrap">
                        <i class="fa-solid fa-box-open text-xs"></i>
                        G√≥i c∆∞·ªõc
                    </button>

                    <!-- Display Dropdown -->
                    <div class="relative">
                        <button id="btn-display"
                            onclick="document.getElementById('displayDropdown').classList.toggle('hidden'); event.stopPropagation();"
                            class="flex items-center gap-1.5 px-3 py-2 bg-white border border-slate-200 text-slate-600 rounded-md text-sm font-medium hover:bg-slate-50 hover:text-blue-600 transition-all whitespace-nowrap">
                            <i class="fa-solid fa-tv text-xs"></i>
                            Hi·ªÉn th·ªã
                        </button>

                        <!-- Dropdown Menu -->
                        <div id="displayDropdown"
                            class="absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-slate-200 overflow-hidden hidden z-50">
                            <div class="p-4 space-y-3">
                                <!-- Section 1: Visibility -->
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2 text-slate-600">
                                        <i class="fa-solid fa-layer-group text-xs"></i>
                                        <span class="text-[10px] font-bold uppercase tracking-wider">Xem danh m·ª•c</span>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer" id="toggle-category"
                                            onchange="toggleCategoryView(this)">
                                        <div
                                            class="w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                        </div>
                                    </label>
                                </div>

                                <div class="border-t border-slate-100"></div>

                                <!-- Section 2: Themes -->
                                <div>
                                    <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Giao
                                        di·ªán th·∫ª</h4>
                                    <!-- Style Gallery Grid -->
                                    <div class="style-gallery">
                                        <div class="style-item active" id="theme-btn-default"
                                            onclick="setModuleTheme('default')">
                                            <div class="style-preview"></div>
                                            <span class="style-name">M·∫∑c ƒë·ªãnh</span>
                                        </div>
                                        <div class="style-item" id="theme-btn-light-bg"
                                            onclick="setModuleTheme('light-bg')">
                                            <div class="style-preview preview-light-bg"></div>
                                            <span class="style-name">N·ªÅn nh·∫°t</span>
                                        </div>
                                        <div class="style-item" id="theme-btn-vertical-8"
                                            onclick="setModuleTheme('vertical-8')">
                                            <div
                                                class="style-preview flex items-center justify-center bg-slate-50 border-slate-200">
                                                <div
                                                    class="w-2 h-2 bg-blue-500 rounded border border-white shadow-sm mb-1">
                                                </div>
                                            </div>
                                            <span class="style-name">Icon d·ªçc</span>
                                        </div>
                                        <div class="style-item" id="theme-btn-classic"
                                            onclick="setModuleTheme('classic')">
                                            <div
                                                class="style-preview flex items-center justify-center bg-white border-slate-200">
                                                <div class="flex items-center gap-1">
                                                    <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                                                </div>
                                            </div>
                                            <span class="style-name">C·ªï ƒëi·ªÉn</span>
                                        </div>
                                        <div class="style-item" id="theme-btn-wave" onclick="setModuleTheme('wave')">
                                            <div
                                                class="style-preview flex items-center justify-center bg-white border-slate-200 overflow-hidden">
                                                <div class="w-full h-full relative">
                                                    <div class="absolute bottom-0 left-0 w-full h-1/2 bg-blue-500/10"
                                                        style="clip-path: ellipse(80% 100% at 50% 100%);"></div>
                                                </div>
                                            </div>
                                            <div class="style-name">S√≥ng</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="border-t border-slate-100"></div>

                                <!-- Section 3: Wallpaper -->
                                <div>
                                    <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">H√¨nh
                                        n·ªÅn</h4>
                                    <div class="flex items-center gap-3 mb-3" id="wallpaper-options">
                                        <button onclick="changeBg('default')" id="bg-btn-default"
                                            class="w-6 h-6 rounded-full border border-slate-200 bg-[#F7F8F9] hover:scale-110 transition-transform bg-btn-active"
                                            title="M·∫∑c ƒë·ªãnh"></button>
                                        <button onclick="changeBg('black')" id="bg-btn-black"
                                            class="w-6 h-6 rounded-full border border-slate-200 bg-black hover:scale-110 transition-transform"
                                            title="ƒêen"></button>
                                        <button onclick="changeBg('lightblue')" id="bg-btn-lightblue"
                                            class="w-6 h-6 rounded-full border border-slate-200 bg-[#e0f2fe] hover:scale-110 transition-transform"
                                            title="Xanh nh·∫°t"></button>
                                        <!-- Thumbnail placeholder created dynamically or hidden initially -->
                                        <div id="custom-bg-thumb" class="hidden" onclick="changeBg('custom')"
                                            title="·∫¢nh ƒë√£ t·∫£i"></div>
                                    </div>
                                    <div class="flex items-center justify-between text-xs text-slate-500 cursor-pointer hover:text-blue-600 transition-colors group"
                                        onclick="document.getElementById('bg-upload-input').click()">
                                        <span class="font-medium text-[10px] uppercase tracking-wider">T·∫£i ·∫£nh</span>
                                        <i
                                            class="fa-solid fa-cloud-arrow-up text-sm group-hover:scale-110 transition-transform"></i>
                                    </div>
                                    <input type="file" id="bg-upload-input" class="hidden" accept="image/*"
                                        onchange="handleBgUpload(this)">
                                </div>

                                <div class="border-t border-slate-100"></div>

                                <!-- Section 4: Effects -->
                                <div class="space-y-3">
                                    <!-- Snow Toggle -->
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2 text-slate-600">
                                            <i class="fa-regular fa-snowflake text-xs animate-pulse text-blue-400"></i>
                                            <span class="text-[10px] font-bold uppercase tracking-wider">Tuy·∫øt
                                                r∆°i</span>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" id="toggle-snow"
                                                onchange="toggleSnow(this)">
                                            <div
                                                class="w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500">
                                            </div>
                                        </label>
                                    </div>

                                    <!-- Sakura Toggle (Cherry Blossom) -->
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2 text-slate-600">
                                            <i class="fa-solid fa-leaf text-pink-400 text-xs animate-bounce"></i>
                                            <span class="text-[10px] font-bold uppercase tracking-wider">Hoa ƒë√†o
                                                r∆°i</span>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" id="toggle-sakura"
                                                onchange="toggleSakura(this)">
                                            <div
                                                class="w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pink-500">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>

        <div id="status-filter-container"
            class="hidden justify-end mb-6 animate-in fade-in slide-in-from-top-2 duration-300">
            <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-slate-500">Tr·∫°ng th√°i:</span>
                <div class="relative flex items-center h-8">
                    <select id="status-filter"
                        class="pl-3 pr-8 py-1 bg-white border border-slate-200 text-slate-600 rounded text-sm font-medium focus:outline-none transition-all appearance-none cursor-pointer h-full">
                        <option value="all">T·∫•t c·∫£</option>
                        <option value="inactive">Ch∆∞a k√≠ch ho·∫°t</option>
                        <option value="pending">Ch·ªù k√≠ch ho·∫°t</option>
                        <option value="active">ƒê√£ k√≠ch ho·∫°t</option>
                    </select>
                    <i
                        class="fa-solid fa-chevron-down absolute right-2 text-[10px] text-slate-400 pointer-events-none"></i>
                </div>
            </div>
        </div>

        <!-- Modules Grid - Categorized View -->
        <div id="categorized-view" class="view-container">

            <!-- 1. ∆Øa th√≠ch -->
            <div id="favorites-section" class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>∆Øa th√≠ch</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div id="favorites-grid"
                    class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- Placeholder for favorites -->
                </div>
            </div>

            <!-- 2. B√°n h√†ng -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>B√°n h√†ng</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- B√°n h√†ng -->
                    <a href="modules/sales.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-blue-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-blue-500 flex-shrink-0 z-10 group-hover:bg-blue-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-cart-shopping text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-blue-700 transition-colors">
                                B√°n h√†ng</h3>
                        </div>
                    </a>
                    <!-- H√≥a ƒë∆°n -->
                    <a href="modules/einvoice.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-blue-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-blue-500 flex-shrink-0 z-10 group-hover:bg-blue-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-file-invoice text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-blue-700 transition-colors">
                                H√≥a ƒë∆°n</h3>
                        </div>
                    </a>
                    <!-- C√¥ng n·ª£ -->
                    <a href="modules/debt.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-indigo-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-indigo-600 flex-shrink-0 z-10 group-hover:bg-indigo-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-file-invoice-dollar text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-indigo-700 transition-colors">
                                C√¥ng n·ª£</h3>
                        </div>
                    </a>
                    <!-- Thanh to√°n -->
                    <a href="modules/payment.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-emerald-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-emerald-600 flex-shrink-0 z-10 group-hover:bg-emerald-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-credit-card text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-emerald-700 transition-colors">
                                Thanh to√°n</h3>
                        </div>
                    </a>
                    <!-- Th·∫ª tr·∫£ tr∆∞·ªõc -->
                    <a href="modules/prepaid.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-emerald-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-emerald-600 flex-shrink-0 z-10 group-hover:bg-emerald-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-money-check-dollar text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-emerald-700 transition-colors">
                                Th·∫ª tr·∫£ tr∆∞·ªõc</h3>
                        </div>
                    </a>
                    <!-- B·∫•t ƒë·ªông s·∫£n -->
                    <a href="modules/realestate.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-sky-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-sky-600 flex-shrink-0 z-10 group-hover:bg-sky-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-building text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-sky-700 transition-colors">
                                B·∫•t ƒë·ªông s·∫£n</h3>
                        </div>
                    </a>
                    <!-- Booking -->
                    <a href="modules/booking.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-blue-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-blue-600 flex-shrink-0 z-10 group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-calendar-check text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-blue-700 transition-colors">
                                Booking</h3>
                        </div>
                    </a>
                </div>
            </div>

            <!-- 3. Li√™n h·ªá -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>Li√™n h·ªá</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- Kh√°ch h√†ng -->
                    <a href="modules/customer.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-emerald-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-emerald-500 flex-shrink-0 z-10 group-hover:bg-emerald-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-user-group text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-emerald-700 transition-colors">
                                Kh√°ch h√†ng</h3>
                        </div>
                    </a>
                    <!-- WorkChatV2 -->
                    <a href="modules/workchat.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-pink-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-pink-500 flex-shrink-0 z-10 group-hover:bg-pink-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-comments text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-pink-700 transition-colors">
                                WorkChatV2</h3>
                        </div>
                    </a>
                    <!-- Mini App (Zalo OA) -->
                    <a href="modules/miniapp.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-blue-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-blue-600 flex-shrink-0 z-10 group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg" alt="Zalo"
                                class="w-6 h-6">
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-blue-700 transition-colors">
                                Zalo OA</h3>
                        </div>
                    </a>
                    <!-- T·ªïng ƒë√†i -->
                    <a href="modules/callcenter.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-green-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-green-600 flex-shrink-0 z-10 group-hover:bg-green-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-headset text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-green-700 transition-colors">
                                T·ªïng ƒë√†i</h3>
                        </div>
                    </a>
                    <!-- Feedback -->
                    <a href="modules/feedback.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-yellow-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-yellow-600 flex-shrink-0 z-10 group-hover:bg-yellow-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-comment-dots text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-yellow-700 transition-colors">
                                Feedback</h3>
                        </div>
                    </a>
                </div>
            </div>

            <!-- 4. Marketing -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>Marketing</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- ∆Øu ƒë√£i -->
                    <a href="modules/promotions.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-red-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-red-500 flex-shrink-0 z-10 group-hover:bg-red-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-tags text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-red-700 transition-colors">
                                ∆Øu ƒë√£i</h3>
                        </div>
                    </a>
                    <!-- Flash Sale -->
                    <a href="modules/flashsale.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-red-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-red-600 flex-shrink-0 z-10 group-hover:bg-red-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-bolt text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-red-700 transition-colors">
                                Flash Sale</h3>
                        </div>
                    </a>
                    <!-- Loyalty -->
                    <a href="modules/loyalty.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-yellow-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-yellow-500 flex-shrink-0 z-10 group-hover:bg-yellow-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-crown text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-yellow-700 transition-colors">
                                Loyalty</h3>
                        </div>
                    </a>
                    <!-- Combo -->
                    <a href="modules/combo.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-orange-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-orange-500 flex-shrink-0 z-10 group-hover:bg-orange-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-layer-group text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-orange-700 transition-colors">
                                Combo</h3>
                        </div>
                    </a>
                    <!-- RFM -->
                    <a href="modules/rfm.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-violet-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-violet-500 flex-shrink-0 z-10 group-hover:bg-violet-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-chart-area text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-violet-700 transition-colors">
                                RFM</h3>
                        </div>
                    </a>
                </div>
            </div>

            <!-- 5. H√†ng h√≥a & T·ªìn kho -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>H√†ng h√≥a & T·ªìn kho</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- S·∫£n ph·∫©m -->
                    <a href="modules/product.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-amber-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-amber-500 flex-shrink-0 z-10 group-hover:bg-amber-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-box-open text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-amber-700 transition-colors">
                                S·∫£n ph·∫©m</h3>
                        </div>
                    </a>
                    <!-- Kho h√†ng -->
                    <a href="modules/warehouse.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-gray-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-gray-500 flex-shrink-0 z-10 group-hover:bg-gray-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-warehouse text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-gray-700 transition-colors">
                                Kho h√†ng</h3>
                        </div>
                    </a>
                    <!-- V·∫≠n chuy·ªÉn -->
                    <a href="modules/shipping.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-amber-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-amber-600 flex-shrink-0 z-10 group-hover:bg-amber-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-truck text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-amber-700 transition-colors">
                                V·∫≠n chuy·ªÉn</h3>
                        </div>
                    </a>
                    <!-- M·∫´u in -->
                    <a href="modules/templates.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-gray-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-gray-600 flex-shrink-0 z-10 group-hover:bg-gray-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-print text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-gray-700 transition-colors">
                                M·∫´u in</h3>
                        </div>
                    </a>
                    <!-- L∆∞u tr·ªØ -->
                    <a href="modules/storage.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-stone-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-stone-600 flex-shrink-0 z-10 group-hover:bg-stone-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-hard-drive text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-stone-700 transition-colors">
                                L∆∞u tr·ªØ</h3>
                        </div>
                    </a>
                </div>
            </div>

            <!-- 6. Qu·∫£n l√Ω n·ªôi dung -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>Qu·∫£n l√Ω n·ªôi dung</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- Webview -->
                    <a href="modules/webview.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-purple-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-purple-600 flex-shrink-0 z-10 group-hover:bg-purple-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-globe text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-purple-700 transition-colors">
                                Webview</h3>
                        </div>
                    </a>
                    <!-- T√≠ch h·ª£p -->
                    <a href="modules/integration.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-cyan-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-cyan-600 flex-shrink-0 z-10 group-hover:bg-cyan-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-plug text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-cyan-700 transition-colors">
                                T√≠ch h·ª£p</h3>
                        </div>
                    </a>
                    <!-- S·ª± ki·ªán -->
                    <a href="modules/events.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-orange-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-orange-600 flex-shrink-0 z-10 group-hover:bg-orange-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-calendar-days text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-orange-700 transition-colors">
                                S·ª± ki·ªán</h3>
                        </div>
                    </a>
                </div>
            </div>

            <!-- 7. C√¥ng c·ª• thi·∫øt k·∫ø -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>C√¥ng c·ª• thi·∫øt k·∫ø</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- Thi·∫øt k·∫ø ·∫£nh -->
                    <a href="modules/imagedesign.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-rose-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-rose-600 flex-shrink-0 z-10 group-hover:bg-rose-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-palette text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-rose-700 transition-colors">
                                Thi·∫øt k·∫ø ·∫£nh</h3>
                        </div>
                    </a>
                    <!-- Thi·∫øt k·∫ø Email -->
                    <a href="modules/emaildesign.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-fuchsia-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-fuchsia-600 flex-shrink-0 z-10 group-hover:bg-fuchsia-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-envelope-open-text text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-fuchsia-700 transition-colors">
                                Thi·∫øt k·∫ø Email</h3>
                        </div>
                    </a>
                </div>
            </div>

            <!-- 8. ·ª®ng d·ª•ng h·ªó tr·ª£ -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>·ª®ng d·ª•ng h·ªó tr·ª£</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- C√†i ƒë·∫∑t -->
                    <a href="modules/settings.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-slate-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-slate-600 flex-shrink-0 z-10 group-hover:bg-slate-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-gear text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-slate-700 transition-colors">
                                C√†i ƒë·∫∑t</h3>
                        </div>
                    </a>
                    <!-- C·ªông t√°c vi√™n -->
                    <a href="modules/collaborator.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-cyan-600 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-cyan-600 flex-shrink-0 z-10 group-hover:bg-cyan-600 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-handshake text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-cyan-700 transition-colors">
                                C·ªông t√°c vi√™n</h3>
                        </div>
                    </a>
                    <!-- B·∫£o h√†nh -->
                    <a href="modules/warranty.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-teal-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-teal-500 flex-shrink-0 z-10 group-hover:bg-teal-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-shield-halved text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-teal-700 transition-colors">
                                B·∫£o h√†nh</h3>
                        </div>
                    </a>
                </div>
            </div>

            <!-- 9. B√°o c√°o - Th·ªëng k√™ -->
            <div class="mb-10">
                <div class="category-header" onclick="toggleCategory(this)">
                    <span>B√°o c√°o - Th·ªëng k√™</span>
                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
                    <!-- B√°o c√°o -->
                    <a href="modules/report.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-indigo-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-indigo-500 flex-shrink-0 z-10 group-hover:bg-indigo-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-chart-simple text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-indigo-700 transition-colors">
                                B√°o c√°o</h3>
                        </div>
                    </a>
                    <!-- CRM -->
                    <a href="modules/crm.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-rose-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-rose-500 flex-shrink-0 z-10 group-hover:bg-rose-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-chart-pie text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-rose-700 transition-colors">
                                CRM</h3>
                        </div>
                    </a>
                    <!-- Automation -->
                    <a href="modules/automation.html"
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200/30 card-hover group flex items-center justify-start gap-3 h-[85px] hover:border-purple-500 relative overflow-hidden transition-all">
                        <div
                            class="w-14 h-14 rounded-2xl bg-white border border-slate-100 shadow-[0_8px_20px_-4px_rgba(0,0,0,0.15)] flex items-center justify-center text-purple-500 flex-shrink-0 z-10 group-hover:bg-purple-500 group-hover:text-white transition-colors duration-300">
                            <i class="fa-solid fa-robot text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="font-bold text-slate-800 text-sm truncate group-hover:text-purple-700 transition-colors">
                                Automation</h3>
                        </div>
                    </a>
                </div>
            </div>
        </div> <!-- End of #categorized-view -->

        <!-- Flat View (Hidden by default) - V10 COMPACT STYLE -->
        <div id="flat-view"
            class="hidden view-container grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 module-grid">
            <!-- Modules will be cloned here when flat view is enabled -->
        </div>

    </main>

    <!-- Simple Footer -->
    <footer class="mt-auto py-6 text-center text-slate-400 text-xs">
        <p>&copy; 2026 Appvn. All rights reserved.</p>
    </footer>

    <script>
        // Close dropdown when clicking outside
        document.addEventListener('click', function (event) {
            const dropdown = document.getElementById('displayDropdown');
            const button = document.getElementById('btn-display');
            if (dropdown && !dropdown.contains(event.target) && !button.contains(event.target)) {
                if (!dropdown.classList.contains('hidden')) {
                    dropdown.classList.add('hidden');
                    saveAppSettings();
                }
            }
        });

        // Change Background Function
        let uploadedBgData = null;
        let currentBgType = 'default';

        function changeBg(type) {
            currentBgType = type;
            // Update selection highlights
            document.querySelectorAll('#wallpaper-options button, #custom-bg-thumb').forEach(btn => {
                btn.classList.remove('bg-btn-active');
            });

            if (type === 'custom' && uploadedBgData) {
                document.body.style.backgroundImage = `url('${uploadedBgData}')`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundPosition = 'center';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundColor = 'transparent';
                document.body.classList.add('theme-dark', 'theme-wallpaper');
                currentSnowColor = '#FFFFFF';
                const thumb = document.getElementById('custom-bg-thumb');
                if (thumb) thumb.classList.add('bg-btn-active');
                return;
            }

            // Clear custom background image if choosing color
            document.body.style.backgroundImage = 'none';

            // Remove special classes
            document.body.classList.remove('theme-dark', 'theme-wallpaper');

            if (type === 'default') {
                document.body.style.backgroundColor = '#F7F8F9';
                currentSnowColor = '#60a5fa'; // More blue for grey theme
                const btn = document.getElementById('bg-btn-default');
                if (btn) btn.classList.add('bg-btn-active');
            } else if (type === 'black') {
                document.body.style.backgroundColor = '#111827';
                document.body.classList.add('theme-dark');
                currentSnowColor = '#FFFFFF';
                const btn = document.getElementById('bg-btn-black');
                if (btn) btn.classList.add('bg-btn-active');
            } else if (type === 'lightblue') {
                document.body.style.backgroundColor = '#e0f2fe';
                currentSnowColor = '#FFFFFF';
                const btn = document.getElementById('bg-btn-lightblue');
                if (btn) btn.classList.add('bg-btn-active');
            }
        }

        // Custom Wallpaper Upload Logic
        function handleBgUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    uploadedBgData = e.target.result;

                    // Show and update thumbnail
                    const thumb = document.getElementById('custom-bg-thumb');
                    if (thumb) {
                        thumb.style.backgroundImage = `url('${uploadedBgData}')`;
                        thumb.classList.remove('hidden');
                    }

                    // Apply immediately
                    changeBg('custom');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- Effects Logic (Snow & Sakura) ---
        let snowActive = false;
        let sakuraActive = false;
        let snowCanvas, snowCtx;
        let flakes = [];
        let petals = [];
        let animationId;
        let currentSnowColor = '#60a5fa'; // Matches default grey theme

        function toggleSnow(checkbox) {
            snowActive = checkbox.checked;
            snowCanvas = document.getElementById('snow-canvas');

            if (snowActive) {
                // Mutual exclusivity: Turn off Sakura
                sakuraActive = false;
                const sakuraToggle = document.getElementById('toggle-sakura');
                if (sakuraToggle) sakuraToggle.checked = false;

                snowCanvas.style.display = 'block';
                initSnow();
                animateSnow();
            } else {
                if (!sakuraActive) snowCanvas.style.display = 'none';
                cancelAnimationFrame(animationId);
            }
        }

        function toggleSakura(checkbox) {
            sakuraActive = checkbox.checked;
            snowCanvas = document.getElementById('snow-canvas');

            if (sakuraActive) {
                // Mutual exclusivity: Turn off Snow
                snowActive = false;
                const snowToggle = document.getElementById('toggle-snow');
                if (snowToggle) snowToggle.checked = false;

                snowCanvas.style.display = 'block';
                initSakura();
                animateSakura();
            } else {
                if (!snowActive) snowCanvas.style.display = 'none';
                cancelAnimationFrame(animationId);
            }
        }

        function initSnow() {
            snowCtx = snowCanvas.getContext('2d');
            resizeSnow();
            window.removeEventListener('resize', resizeSnow);
            window.addEventListener('resize', resizeSnow);

            flakes = [];
            const flakeCount = 150;
            for (let i = 0; i < flakeCount; i++) {
                flakes.push({
                    x: Math.random() * snowCanvas.width,
                    y: Math.random() * snowCanvas.height,
                    radius: Math.random() * 2 + 0.5,
                    speed: Math.random() * 1 + 0.5,
                    wind: Math.random() * 1 - 0.5,
                    opacity: Math.random() * 0.5 + 0.3
                });
            }
        }

        function initSakura() {
            snowCtx = snowCanvas.getContext('2d');
            resizeSnow();
            window.removeEventListener('resize', resizeSnow);
            window.addEventListener('resize', resizeSnow);

            petals = [];
            const petalCount = 80; // Fewer but larger
            for (let i = 0; i < petalCount; i++) {
                petals.push({
                    x: Math.random() * snowCanvas.width,
                    y: Math.random() * snowCanvas.height,
                    size: Math.random() * 6 + 4,
                    speed: Math.random() * 1 + 0.5,
                    angle: Math.random() * Math.PI * 2,
                    angleSpeed: Math.random() * 0.02 - 0.01,
                    sway: Math.random() * 2,
                    swaySpeed: Math.random() * 0.02 + 0.01,
                    opacity: Math.random() * 0.5 + 0.4
                });
            }
        }

        function resizeSnow() {
            if (snowCanvas) {
                snowCanvas.width = window.innerWidth;
                snowCanvas.height = window.innerHeight;
            }
        }

        function animateSnow() {
            if (!snowActive) return;

            snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
            snowCtx.fillStyle = currentSnowColor;

            flakes.forEach(flake => {
                snowCtx.beginPath();
                snowCtx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
                snowCtx.fill();

                flake.y += flake.speed;
                flake.x += flake.wind;

                if (flake.y > snowCanvas.height) {
                    flake.y = -10;
                    flake.x = Math.random() * snowCanvas.width;
                }
                if (flake.x > snowCanvas.width) flake.x = 0;
                else if (flake.x < 0) flake.x = snowCanvas.width;
            });

            animationId = requestAnimationFrame(animateSnow);
        }

        function animateSakura() {
            if (!sakuraActive) return;

            snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);

            petals.forEach(petal => {
                snowCtx.save();
                snowCtx.translate(petal.x, petal.y);
                snowCtx.rotate(petal.angle);

                // Draw petal (egg shape)
                snowCtx.beginPath();
                snowCtx.fillStyle = `rgba(255, 183, 197, ${petal.opacity})`; // Soft pink
                snowCtx.ellipse(0, 0, petal.size, petal.size / 2, 0, 0, Math.PI * 2);
                snowCtx.fill();

                // Add a small vein/detail
                snowCtx.strokeStyle = `rgba(255, 105, 180, ${petal.opacity * 0.5})`; // Slightly darker pink
                snowCtx.lineWidth = 0.5;
                snowCtx.stroke();

                snowCtx.restore();

                // Update position
                petal.y += petal.speed;
                petal.x += Math.sin(petal.y * petal.swaySpeed) * petal.sway;
                petal.angle += petal.angleSpeed;

                if (petal.y > snowCanvas.height + 10) {
                    petal.y = -10;
                    petal.x = Math.random() * snowCanvas.width;
                }
                if (petal.x > snowCanvas.width) petal.x = 0;
                else if (petal.x < 0) petal.x = snowCanvas.width;
            });

            animationId = requestAnimationFrame(animateSakura);
        }

        // --- Settings Persistence Logic ---
        function saveAppSettings() {
            const settings = {
                theme: localStorage.getItem('appvn_module_theme') || 'default',
                bgType: currentBgType,
                bgData: uploadedBgData,
                categoryView: document.getElementById('toggle-category')?.checked,
                snowActive: snowActive,
                sakuraActive: sakuraActive
            };
            localStorage.setItem('appvn_settings', JSON.stringify(settings));
        }

        function loadAppSettings() {
            const saved = localStorage.getItem('appvn_settings');
            if (!saved) return;

            try {
                const settings = JSON.parse(saved);

                // 1. Load Category View
                const toggleCat = document.getElementById('toggle-category');
                if (toggleCat && settings.categoryView !== undefined) {
                    toggleCat.checked = settings.categoryView;
                    toggleCategoryView(toggleCat, true);
                }

                // 2. Load Theme
                if (settings.theme) {
                    setModuleTheme(settings.theme);
                }

                // 3. Load Background
                if (settings.bgData) {
                    uploadedBgData = settings.bgData;
                    const thumb = document.getElementById('custom-bg-thumb');
                    if (thumb) {
                        thumb.style.backgroundImage = `url('${uploadedBgData}')`;
                        thumb.classList.remove('hidden');
                    }
                }
                if (settings.bgType) {
                    changeBg(settings.bgType);
                }

                // 4. Load Effects
                if (settings.snowActive) {
                    const snowToggle = document.getElementById('toggle-snow');
                    if (snowToggle) {
                        snowToggle.checked = true;
                        toggleSnow(snowToggle);
                    }
                } else if (settings.sakuraActive) {
                    const sakuraToggle = document.getElementById('toggle-sakura');
                    if (sakuraToggle) {
                        sakuraToggle.checked = true;
                        toggleSakura(sakuraToggle);
                    }
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
        }

        // Search Modules Function
        function searchModules(query) {
            const searchTerm = query.toLowerCase().trim();
            const allModules = document.querySelectorAll('.card-hover');

            allModules.forEach(module => {
                const titleEl = module.querySelector('h3');
                const title = titleEl ? titleEl.textContent.toLowerCase().trim() : '';

                if (searchTerm === '' || title.includes(searchTerm)) {
                    module.classList.remove('hidden');
                } else {
                    module.classList.add('hidden');
                }
            });

            updateCategoryVisibility();
        }

        function updateCategoryVisibility() {
            const categories = document.querySelectorAll('#categorized-view > div');
            categories.forEach(category => {
                const modules = category.querySelectorAll('.card-hover');
                if (modules.length === 0) return;

                let hasVisibleModule = false;
                modules.forEach(m => {
                    if (!m.classList.contains('hidden')) {
                        hasVisibleModule = true;
                    }
                });

                if (hasVisibleModule) {
                    category.classList.remove('hidden');
                } else {
                    category.classList.add('hidden');
                }
            });
        }

        // My Apps List (hardcoded)
        const myAppsList = [
            'B√°n h√†ng', 'H√≥a ƒë∆°n', 'Kh√°ch h√†ng', 'C√¥ng n·ª£',
            'Thanh to√°n', 'S·∫£n ph·∫©m', 'Kho h√†ng', 'B√°o c√°o',
            'CRM', 'Automation'
        ];
        let isMyAppsActive = true;
        let isAppStoreMode = false;
        let currentStatusFilter = 'all';

        // Navigation Tabs Logic
        const btnMyApps = document.getElementById('btn-my-apps');
        const btnAppStore = document.getElementById('btn-app-store');
        const statusFilterContainer = document.getElementById('status-filter-container');
        const statusFilter = document.getElementById('status-filter');

        function updateTabStyles() {
            if (isMyAppsActive) {
                // My Apps Active
                btnMyApps.classList.remove('bg-white', 'border-slate-200', 'text-slate-600', 'hover:bg-slate-50', 'hover:text-blue-600');
                btnMyApps.classList.add('bg-blue-600', 'border-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700');

                // App Store Inactive
                btnAppStore.classList.add('bg-white', 'border-slate-200', 'text-slate-600', 'hover:bg-slate-50', 'hover:text-blue-600');
                btnAppStore.classList.remove('bg-blue-600', 'border-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700');

                // Hide status filter
                if (statusFilterContainer) {
                    statusFilterContainer.classList.add('hidden');
                    statusFilterContainer.classList.remove('flex');
                }
            } else {
                // My Apps Inactive
                btnMyApps.classList.add('bg-white', 'border-slate-200', 'text-slate-600', 'hover:bg-slate-50', 'hover:text-blue-600');
                btnMyApps.classList.remove('bg-blue-600', 'border-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700');

                // App Store Active
                btnAppStore.classList.remove('bg-white', 'border-slate-200', 'text-slate-600', 'hover:bg-slate-50', 'hover:text-blue-600');
                btnAppStore.classList.add('bg-blue-600', 'border-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700');

                // Show status filter
                if (statusFilterContainer) {
                    statusFilterContainer.classList.remove('hidden');
                    statusFilterContainer.classList.add('flex');
                }
            }
        }

        if (btnMyApps) {
            btnMyApps.addEventListener('click', function () {
                if (isMyAppsActive) return;

                const categorizedView = document.getElementById('categorized-view');
                const flatView = document.getElementById('flat-view');

                // Transition out
                if (categorizedView) categorizedView.classList.add('fade-out');
                if (flatView) flatView.classList.add('fade-out');

                setTimeout(() => {
                    isMyAppsActive = true;
                    isAppStoreMode = false;
                    updateTabStyles();
                    applyMyAppsFilter();
                    toggleAppStoreMode();

                    // Transition in
                    setTimeout(() => {
                        if (categorizedView) categorizedView.classList.remove('fade-out');
                        if (flatView) flatView.classList.remove('fade-out');
                    }, 50);
                }, 300);
            });
        }

        function applyMyAppsFilter() {
            const allModules = document.querySelectorAll('.card-hover');

            allModules.forEach(module => {
                const titleEl = module.querySelector('h3');
                const title = titleEl ? titleEl.textContent.trim() : '';

                if (isMyAppsActive) {
                    if (myAppsList.includes(title)) {
                        module.classList.remove('hidden');
                    } else {
                        module.classList.add('hidden');
                    }
                } else {
                    module.classList.remove('hidden');
                }
            });

            updateCategoryVisibility();
        }

        if (btnAppStore) {
            btnAppStore.addEventListener('click', function () {
                if (isAppStoreMode) return;

                const categorizedView = document.getElementById('categorized-view');
                const flatView = document.getElementById('flat-view');

                // Transition out
                if (categorizedView) categorizedView.classList.add('fade-out');
                if (flatView) flatView.classList.add('fade-out');

                setTimeout(() => {
                    isAppStoreMode = true;
                    isMyAppsActive = false;
                    updateTabStyles();
                    applyMyAppsFilter();
                    toggleAppStoreMode();

                    // Transition in
                    setTimeout(() => {
                        if (categorizedView) categorizedView.classList.remove('fade-out');
                        if (flatView) flatView.classList.remove('fade-out');
                    }, 50);
                }, 300);
            });
        }

        // Status Filter Change
        if (statusFilter) {
            statusFilter.addEventListener('change', function () {
                currentStatusFilter = this.value;
                applyStatusFilter();
            });
        }

        const appDescriptions = {
            'B·∫£n ƒë·ªì nh√† thu·ªëc': '·ª®ng d·ª•ng gi√∫p b·∫°n t√¨m ki·∫øm v√† qu·∫£n l√Ω h·ªá th·ªëng nh√† thu·ªëc tr√™n b·∫£n ƒë·ªì, h·ªó tr·ª£ ƒëi·ªÅu h∆∞·ªõng v√† ki·ªÉm tra th√¥ng tin li√™n h·ªá m·ªôt c√°ch nhanh ch√≥ng.',
            'SMS Brandname': 'Gi·∫£i ph√°p g·ª≠i tin nh·∫Øn marketing v√† th√¥ng b√°o t·ª± ƒë·ªông v·ªõi ƒë·ªãnh danh th∆∞∆°ng hi·ªáu ri√™ng, tƒÉng m·ª©c ƒë·ªô uy t√≠n v√† ti·∫øp c·∫≠n kh√°ch h√†ng.',
            'Zalo OA': 'K·∫øt n·ªëi tr·ª±c ti·∫øp v·ªõi kh√°ch h√†ng th√¥ng qua Zalo Official Account, h·ªó tr·ª£ chƒÉm s√≥c kh√°ch h√†ng v√† g·ª≠i th√¥ng b√°o tin nh·∫Øn OA t·ª± ƒë·ªông.',
            'M·∫°ng x√£ h·ªôi': 'T√≠ch h·ª£p c√°c n·ªÅn t·∫£ng m·∫°ng x√£ h·ªôi ƒë·ªÉ qu·∫£n l√Ω b√†i vi·∫øt, t∆∞∆°ng t√°c v√† theo d√µi hi·ªáu qu·∫£ truy·ªÅn th√¥ng t·ª´ m·ªôt giao di·ªán duy nh·∫•t.',
            'Ph√¢n t√≠ch d·ªØ li·ªáu': 'C√¥ng c·ª• ph√¢n t√≠ch chuy√™n s√¢u v·ªõi c√°c bi·ªÉu ƒë·ªì tr·ª±c quan, gi√∫p b·∫°n ƒë∆∞a ra quy·∫øt ƒë·ªãnh kinh doanh d·ª±a tr√™n d·ªØ li·ªáu th·ª±c t·∫ø.',
            'Tr√≠ tu·ªá nh√¢n t·∫°o': 'S·ª≠ d·ª•ng AI ƒë·ªÉ t·ª± ƒë·ªông h√≥a quy tr√¨nh, ph√¢n lo·∫°i kh√°ch h√†ng v√† d·ª± b√°o xu h∆∞·ªõng th·ªã tr∆∞·ªùng trong t∆∞∆°ng lai.'
        };

        function openAppModal(title, iconClass, colorClass) {
            const modal = document.getElementById('app-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalDesc = document.getElementById('modal-desc');
            const modalIcon = document.getElementById('modal-icon');
            const modalIconI = modalIcon.querySelector('i');

            if (modal && modalTitle && modalDesc && modalIcon) {
                modalTitle.textContent = title;
                modalDesc.textContent = appDescriptions[title] || 'ƒêang c·∫≠p nh·∫≠t m√¥ t·∫£ chi ti·∫øt cho ·ª©ng d·ª•ng n√†y. Vui l√≤ng quay l·∫°i sau.';

                // Update icon and color
                modalIconI.className = iconClass;
                modalIcon.className = `w-20 h-20 rounded-3xl text-white flex items-center justify-center text-4xl mx-auto mb-4 shadow-lg ${colorClass}`;

                modal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent scroll
            }
        }

        window.closeAppModal = function () {
            const modal = document.getElementById('app-modal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = ''; // Restore scroll
            }
        };

        // Close modal on click outside content
        window.onclick = function (event) {
            const modal = document.getElementById('app-modal');
            if (event.target == modal) {
                closeAppModal();
            }
        };

        // Module Themes Logic
        const tailwindColorMap = {
            'blue-500': '59, 130, 246', 'blue-600': '37, 99, 235',
            'emerald-500': '16, 185, 129', 'emerald-600': '5, 150, 105',
            'indigo-600': '79, 70, 229', 'indigo-500': '99, 102, 241',
            'sky-600': '2, 132, 199', 'sky-500': '14, 165, 233',
            'pink-500': '236, 72, 153', 'green-600': '22, 163, 74',
            'yellow-600': '202, 138, 4', 'yellow-500': '234, 179, 8',
            'red-500': '239, 68, 68', 'red-600': '220, 38, 38',
            'orange-500': '249, 115, 22', 'orange-600': '234, 88, 12',
            'violet-500': '139, 92, 246', 'amber-500': '245, 158, 11',
            'gray-500': '107, 114, 128', 'gray-600': '75, 85, 99',
            'stone-600': '87, 83, 78', 'purple-600': '147, 51, 234',
            'purple-500': '168, 85, 247', 'cyan-600': '8, 145, 178',
            'cyan-500': '6, 182, 212', 'rose-600': '225, 29, 72',
            'rose-500': '244, 63, 94', 'fuchsia-600': '192, 38, 211',
            'slate-600': '71, 85, 105', 'teal-500': '20, 184, 166'
        };

        function setModuleTheme(themeName) {
            const allModules = document.querySelectorAll('.card-hover');
            const galleryItems = document.querySelectorAll('.style-item');

            // Remove active state from all gallery items and add to selected one
            galleryItems.forEach(item => {
                item.classList.remove('active');
                if (item.id === `theme-btn-${themeName}`) {
                    item.classList.add('active');
                }
            });

            // Theme class mapping
            const themeClasses = {
                'light-bg': 'card-light-bg',
                'soft-pure': 'card-soft-pure',
                'border-focus': 'card-border-focus',
                'soft-elevation': 'card-soft-elevated',
                'minimalist': 'card-minimalist'
            };

            allModules.forEach(card => {
                // Remove all possible theme classes
                Object.values(themeClasses).forEach(cls => card.classList.remove(cls));
                card.style.removeProperty('--theme-rgb');

                // Apply selected theme class
                const selectedClass = themeClasses[themeName];
                if (selectedClass) {
                    card.classList.add(selectedClass);

                    // Special logic for themes that need the icon color
                    if (themeName === 'light-bg' || themeName === 'border-focus' || themeName === 'minimalist' || themeName === 'wave') {
                        const iconContainer = card.querySelector('.w-14');
                        if (iconContainer) {
                            const colorClass = Array.from(iconContainer.classList).find(c => c.startsWith('text-'));
                            if (colorClass) {
                                const colorKey = colorClass.replace('text-', '');
                                const rgb = tailwindColorMap[colorKey];
                                if (rgb) card.style.setProperty('--theme-rgb', rgb);
                            }
                        }
                    }
                }
            });

            localStorage.setItem('appvn_module_theme', themeName);
        }

        // Initialize theme on load
        function initTheme() {
            const savedTheme = localStorage.getItem('appvn_module_theme') || 'default';
            setModuleTheme(savedTheme);
        }

        function decorateModuleCards() {
            const allModules = document.querySelectorAll('.card-hover');
            allModules.forEach(module => {
                // Ensure we don't double-decorate
                if (module.querySelector('.view-details')) return;

                const textContainer = module.querySelector('.flex-1');
                const titleEl = module.querySelector('h3');
                const title = titleEl ? titleEl.textContent.trim() : '';

                // Get icon info for modal
                const iconContainer = module.querySelector('.w-14');
                const iconEl = iconContainer ? iconContainer.querySelector('i') : null;
                const iconClass = iconEl ? iconEl.className : 'fa-solid fa-cube';
                const colorClass = iconContainer ? Array.from(iconContainer.classList).find(c => c.startsWith('text-')) : 'text-blue-500';

                // Add "Xem chi ti·∫øt" link
                if (textContainer) {
                    const viewDetails = document.createElement('span');
                    viewDetails.className = 'view-details';
                    viewDetails.textContent = 'Xem chi ti·∫øt';
                    textContainer.appendChild(viewDetails);

                    // Add Access link for Wave theme
                    const accessLink = document.createElement('div');
                    accessLink.className = 'wave-access';
                    accessLink.innerHTML = 'Truy c·∫≠p <i class="fa-solid fa-arrow-right ml-1 text-[8px]"></i>';
                    textContainer.appendChild(accessLink);
                }

                // Add Status Button
                const isActive = myAppsList.includes(title);
                const isPending = title.includes('Zalo') || title.includes('SMS');

                const statusBtn = document.createElement('div');
                statusBtn.className = 'status-badge ml-auto';

                if (isActive) {
                    statusBtn.textContent = 'ƒê√£ k√≠ch ho·∫°t';
                    statusBtn.classList.add('status-active');
                } else if (isPending) {
                    statusBtn.textContent = 'Ch·ªù k√≠ch ho·∫°t';
                    statusBtn.classList.add('status-pending');
                } else {
                    statusBtn.textContent = 'K√≠ch ho·∫°t';
                    statusBtn.classList.add('status-inactive');
                }

                module.appendChild(statusBtn);

                // Adjust card classes for App Store layout
                module.classList.remove('justify-start');
                module.classList.add('justify-between');

                // Modal Triggering
                module.addEventListener('click', function (e) {
                    if (isAppStoreMode && !isActive) {
                        e.preventDefault();
                        e.stopPropagation();
                        openAppModal(title, iconClass, colorClass);
                    }
                });
            });
        }

        function applyThemeToModules(themeName) {
            const allModules = document.querySelectorAll('.card-hover');
            const allGrids = document.querySelectorAll('.module-grid');

            // Toggle Body Class and Grid Properties for layout changes
            if (themeName === 'vertical-8') {
                document.body.classList.add('theme-vertical-8');
                document.body.classList.remove('theme-wave');
                allGrids.forEach(grid => {
                    grid.style.setProperty('grid-template-columns', 'repeat(8, minmax(0, 1fr))', 'important');
                    grid.style.setProperty('gap', '1.5rem 0.5rem', 'important');
                });
            } else if (themeName === 'wave') {
                document.body.classList.add('theme-wave');
                document.body.classList.remove('theme-vertical-8');
                allGrids.forEach(grid => {
                    grid.style.setProperty('grid-template-columns', 'repeat(3, minmax(0, 1fr))', 'important');
                    grid.style.setProperty('gap', '1.25rem', 'important');
                });
            } else {
                document.body.classList.remove('theme-vertical-8', 'theme-wave');
                allGrids.forEach(grid => {
                    grid.style.removeProperty('grid-template-columns');
                    grid.style.removeProperty('gap');
                });
            }

            // Theme class mapping
            const themeClasses = {
                'light-bg': 'card-light-bg',
                'vertical-8': 'card-vertical-8',
                'classic': 'card-classic',
                'wave': 'card-wave'
            };

            allModules.forEach(card => {
                // Remove all possible theme classes
                Object.values(themeClasses).forEach(cls => card.classList.remove(cls));
                card.style.removeProperty('--theme-rgb');

                // Manage group-hover classes (fix for vertical-8 and classic white icon issue)
                const iconContainer = card.querySelector('.w-14');
                if (iconContainer) {
                    if (themeName === 'vertical-8' || themeName === 'classic' || themeName === 'wave') {
                        // Backup and remove hover classes
                        const hoverClasses = [];
                        iconContainer.classList.forEach(cls => {
                            if (cls.startsWith('group-hover:')) {
                                hoverClasses.push(cls);
                            }
                        });

                        if (hoverClasses.length > 0) {
                            iconContainer.dataset.hoverClasses = hoverClasses.join(' ');
                            iconContainer.classList.remove(...hoverClasses);
                        }
                    } else {
                        // Restore hover classes if they were removed
                        if (iconContainer.dataset.hoverClasses) {
                            const classesToRestore = iconContainer.dataset.hoverClasses.split(' ');
                            iconContainer.classList.add(...classesToRestore);
                            delete iconContainer.dataset.hoverClasses;
                        }
                    }
                }

                // Apply selected theme class
                const selectedClass = themeClasses[themeName];
                if (selectedClass) {
                    card.classList.add(selectedClass);

                    // Special logic for themes that need the icon color
                    if (themeName === 'light-bg') {
                        const iconContainer = card.querySelector('.w-14');
                        if (iconContainer) {
                            const colorClass = Array.from(iconContainer.classList).find(c => c.startsWith('text-'));
                            if (colorClass) {
                                const colorKey = colorClass.replace('text-', '');
                                const rgb = tailwindColorMap[colorKey];
                                if (rgb) card.style.setProperty('--theme-rgb', rgb);
                            }
                        }
                    }
                }
            });
        }


        function setModuleTheme(themeName) {
            // Save preference
            localStorage.setItem('appvn_module_theme', themeName);

            const galleryItems = document.querySelectorAll('.style-item');

            // Remove active state from all gallery items and add to selected one
            galleryItems.forEach(item => {
                item.classList.remove('active');
                if (item.id === `theme-btn-${themeName}`) {
                    item.classList.add('active');
                }
            });

            // Only apply theme if NOT in App Store mode
            if (!isAppStoreMode) {
                applyThemeToModules(themeName);
            }
        }

        function toggleAppStoreMode() {
            const welcomeText = document.querySelector('main p.text-slate-500');
            const categorizedView = document.getElementById('categorized-view');
            const flatView = document.getElementById('flat-view');

            if (isAppStoreMode) {
                // Apply app store layout
                if (categorizedView) categorizedView.classList.add('app-store-view');
                if (flatView) flatView.classList.add('app-store-view');

                // Force default theme in App Store
                applyThemeToModules('default');

                decorateModuleCards();

                // Change welcome message
                if (welcomeText) {
                    welcomeText.textContent = 'Ch√†o m·ª´ng b·∫°n ƒë·∫øn kho ·ª©ng d·ª•ng';
                }

                // Disable My Apps filter
                if (isMyAppsActive) {
                    btnMyApps.click();
                }

                // Apply current status filter
                applyStatusFilter();
            } else {
                // Remove app store layout
                if (categorizedView) categorizedView.classList.remove('app-store-view');
                if (flatView) flatView.classList.remove('app-store-view');

                // Restore user theme preference when back in My Apps
                const savedTheme = localStorage.getItem('appvn_module_theme') || 'default';
                applyThemeToModules(savedTheme);

                // Restore welcome message
                if (welcomeText) {
                    welcomeText.textContent = 'Ch√†o m·ª´ng b·∫°n quay tr·ªü l·∫°i. H√£y ch·ªçn m·ªôt module ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m vi·ªác.';
                }
            }

            // Refresh favorites visibility based on mode
            renderFavorites();
        }

        function applyStatusFilter() {
            if (!isAppStoreMode) return;

            const allModules = document.querySelectorAll('.card-hover');

            allModules.forEach(module => {
                const titleEl = module.querySelector('h3');
                const title = titleEl ? titleEl.textContent.trim() : '';
                const isActive = myAppsList.includes(title);
                // For demo: Zalo and SMS are "pending"
                const isPending = title.includes('Zalo') || title.includes('SMS');

                let shouldShow = false;

                switch (currentStatusFilter) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'active':
                        shouldShow = isActive;
                        break;
                    case 'pending':
                        shouldShow = isPending && !isActive;
                        break;
                    case 'inactive':
                        shouldShow = !isActive && !isPending;
                        break;
                }

                if (shouldShow) {
                    module.classList.remove('hidden');
                } else {
                    module.classList.add('hidden');
                }
            });

            updateCategoryVisibility();
        }

        // Toggle Category View
        function toggleCategoryView(checkbox, isInit = false) {
            const categorizedView = document.getElementById('categorized-view');
            const flatView = document.getElementById('flat-view');
            const searchBox = document.getElementById('search-box');

            // Save state
            localStorage.setItem('appvn_category_view', checkbox.checked);

            // Toggle star visibility
            if (checkbox.checked) {
                document.body.classList.remove('hide-stars');
            } else {
                document.body.classList.add('hide-stars');
            }

            if (isInit) {
                // Silent update for initialization
                if (checkbox.checked) {
                    if (categorizedView) categorizedView.classList.remove('hidden');
                    if (flatView) flatView.classList.add('hidden');
                } else {
                    if (categorizedView) categorizedView.classList.add('hidden');
                    if (flatView) {
                        flatView.classList.remove('hidden');
                        renderFlatView();
                    }
                }
                return;
            }

            // 1. Start Fade Out
            if (categorizedView) categorizedView.classList.add('fade-out');
            if (flatView) flatView.classList.add('fade-out');

            setTimeout(() => {
                if (checkbox.checked) {
                    // Show categorized view
                    if (categorizedView) categorizedView.classList.remove('hidden');
                    if (flatView) flatView.classList.add('hidden');
                } else {
                    // Show flat view (unified grid)
                    if (categorizedView) categorizedView.classList.add('hidden');
                    if (flatView) {
                        flatView.classList.remove('hidden');
                        renderFlatView();
                    }
                }

                // Re-run search if needed
                if (searchBox && searchBox.value) {
                    searchModules(searchBox.value);
                }

                // 2. Fade In
                setTimeout(() => {
                    if (categorizedView) categorizedView.classList.remove('fade-out');
                    if (flatView) flatView.classList.remove('fade-out');
                }, 50);

            }, 300); // Match CSS transition duration

            // Reset opacity scroll effect
            if (!checkbox.checked) {
                const welcome = document.getElementById('welcome-section');
                const toolbar = document.getElementById('toolbar-section');
                const header = document.getElementById('main-header');
                if (welcome) welcome.style.opacity = 1;
                if (toolbar) toolbar.style.opacity = 1;
                if (header) header.style.opacity = 1;
            }
        }

        function renderFlatView() {
            const flatView = document.getElementById('flat-view');
            if (!flatView) return;

            flatView.innerHTML = '';
            const titlesAdded = new Set();

            // Collect all modules from categorized view categories (excluding Favorites)
            const originalModules = document.querySelectorAll('#categorized-view > div:not(:first-child) .card-hover');

            originalModules.forEach(module => {
                const title = module.querySelector('h3').textContent.trim();
                if (!titlesAdded.has(title)) {
                    const clone = module.cloneNode(true);
                    const starBtn = clone.querySelector('.favorite-star');
                    if (starBtn) {
                        starBtn.onclick = (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            toggleFavorite(title, starBtn);
                        };
                    }
                    flatView.appendChild(clone);
                    titlesAdded.add(title);
                }
            });

            // Decorate cards in flat view if needed
            if (isAppStoreMode) {
                decorateModuleCards();
            }
        }

        // Toggle Individual Category Collapse
        function toggleCategory(header) {
            const grid = header.nextElementSibling;
            if (!grid) return;

            header.classList.toggle('collapsed');
            grid.classList.toggle('collapsed');
        }

        // --- Favorites System Logic ---
        let favorites = JSON.parse(localStorage.getItem('appvn_favorites')) || [];

        function initFavorites() {
            const allModules = document.querySelectorAll('.card-hover');
            allModules.forEach(module => {
                const titleEl = module.querySelector('h3');
                if (!titleEl) return;
                const title = titleEl.textContent.trim();

                // Create Star Button
                const starBtn = document.createElement('button');
                starBtn.className = 'favorite-star absolute top-2 right-2 text-slate-300 hover:text-amber-400 z-20 opacity-0 group-hover:opacity-100 transition-opacity p-1';
                starBtn.innerHTML = '<i class="fa-solid fa-star text-base"></i>';

                if (favorites.includes(title)) {
                    starBtn.classList.add('active');
                }

                starBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleFavorite(title, starBtn);
                });

                module.appendChild(starBtn);
            });
            renderFavorites();
        }

        function toggleFavorite(title, btn) {
            const index = favorites.indexOf(title);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(title);
            }
            localStorage.setItem('appvn_favorites', JSON.stringify(favorites));

            // Sync all instances of the same module star
            document.querySelectorAll('.card-hover').forEach(card => {
                const cardTitleEl = card.querySelector('h3');
                if (cardTitleEl && cardTitleEl.textContent.trim() === title) {
                    const cardStar = card.querySelector('.favorite-star');
                    if (cardStar) {
                        if (favorites.includes(title)) cardStar.classList.add('active');
                        else cardStar.classList.remove('active');
                    }
                }
            });

            renderFavorites();
        }

        function renderFavorites() {
            const favGrid = document.getElementById('favorites-grid');
            if (!favGrid) return;

            favGrid.innerHTML = '';

            // Find modules that are favorited and clone them
            const allOriginalModules = Array.from(document.querySelectorAll('#categorized-view > div:not(:first-child) .card-hover'));

            favorites.forEach(title => {
                const original = allOriginalModules.find(m => m.querySelector('h3').textContent.trim() === title);
                if (original) {
                    const clone = original.cloneNode(true);
                    // Update star logic for the clone
                    const starBtn = clone.querySelector('.favorite-star');
                    if (starBtn) {
                        starBtn.classList.add('active');
                        starBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            toggleFavorite(title, starBtn);
                        });
                    }
                    favGrid.appendChild(clone);
                }
            });

            // Hide/Show Favorites Category
            const favSection = document.getElementById('favorites-section');
            if (isAppStoreMode || favorites.length === 0) {
                if (favSection) favSection.classList.add('hidden');
            } else {
                if (favSection) favSection.classList.remove('hidden');
                // Re-apply theme to newly cloned favorites
                if (typeof setModuleTheme === 'function') {
                    const savedTheme = localStorage.getItem('appvn_module_theme') || 'default';
                    setModuleTheme(savedTheme);
                }
            }
        }

        // --- Scroll Fade Logic ---
        function initScrollFade() {
            const welcome = document.getElementById('welcome-section');
            const toolbar = document.getElementById('toolbar-section');
            const toggleCat = document.getElementById('toggle-category');

            if (!welcome || !toolbar) return;

            window.addEventListener('scroll', () => {
                // Only fade if categorized view is enabled
                if (toggleCat && toggleCat.checked) {
                    const scrollTop = window.scrollY;
                    const fadeStart = 0;
                    const fadeEnd = 300; // Fully transparent at 300px

                    let opacity = 1 - (scrollTop / (fadeEnd - fadeStart));
                    if (opacity < 0) opacity = 0;
                    if (opacity > 1) opacity = 1;

                    welcome.style.opacity = opacity;
                    toolbar.style.opacity = opacity;
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initFavorites();

            // Load and apply all user settings
            loadAppSettings();

            initScrollFade();

            // Initialize default tab state
            applyMyAppsFilter();
        });
    </script>

    <!-- App Description Modal -->
    <div id="app-modal" class="modal-overlay">
        <div class="modal-content relative">
            <i class="fa-solid fa-xmark modal-close" onclick="closeAppModal()"></i>
            <div class="modal-header">
                <div id="modal-icon"
                    class="w-20 h-20 rounded-3xl bg-blue-500 text-white flex items-center justify-center text-4xl mx-auto mb-4 shadow-lg">
                    <i class="fa-solid fa-cube"></i>
                </div>
                <h2 id="modal-title" class="text-2xl font-bold text-slate-800">T√™n s·∫£n ph·∫©m</h2>
            </div>
            <div class="modal-body">
                <p id="modal-desc" class="text-slate-600 leading-relaxed text-center">
                    ƒê√¢y l√† m√¥ t·∫£ chi ti·∫øt v·ªÅ ·ª©ng d·ª•ng. ·ª®ng d·ª•ng n√†y gi√∫p b·∫°n qu·∫£n l√Ω c√°c ho·∫°t ƒë·ªông kinh doanh m·ªôt c√°ch
                    hi·ªáu qu·∫£ v√† chuy√™n nghi·ªáp.
                </p>
            </div>
            <div class="modal-footer">
                <button
                    class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold shadow-lg transition-all active:scale-95">
                    K√≠ch ho·∫°t ngay
                </button>
            </div>
        </div>
    </div>

    <canvas id="snow-canvas"></canvas>
</body>

</html>